angular.module("BuscaAtivaEscolarAlert",["ngResource","ui.bootstrap","ui.select","ui.utils.masks","pathgather.popeye"]),angular.module("BuscaAtivaEscolarAlert").controller("formCtrl",function(e,a,t,r,n,o){a.static=n,e.class="state-not-submitted",a.modal=function(a,t){e.isValid=a,e.alert=t;o.openModal({templateUrl:"confirm-dialog.html",controller:"formCtrl",closed:{}})},a.fetchCities=function(e){var t={name:e,$hide_loading_feedback:!0};return a.alert.place_uf&&(t.uf=a.alert.place_uf),console.log("[create_alert] Looking for cities: ",t),r.search(t).$promise.then(function(e){return e.results})},a.renderSelectedCity=function(e){return e?e.uf+" / "+e.name:""},a.createAlert=function(){if(e.isValid){console.log("success");var a={email:e.alert.email,name:e.alert.name,place_reference:e.alert.place_reference,alert_cause_id:e.alert.alert_cause_id,mother_name:e.alert.mother_name,place_address:e.alert.place_address,place_neighborhood:e.alert.place_neighborhood,place_city_id:e.alert.place_city.ibge_city_id,place_city_name:e.alert.place_city.name,place_uf:e.alert.place_uf};if(console.log(e.alert.dob),"undefined"!=typeof e.alert.dob){var r=new Date(e.alert.dob);r=r.toLocaleDateString("eu-ES"),console.log(r),a.dob=r}var n={headers:{"Content-Type":"application/json"}};return t.post("http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/integration/lp/alert_spawn",JSON.stringify(a),n).then(function(a){"invalid_user"==a.data.reason?(console.log(a.data.reason),console.log("invalid_user"==a.data.reason),o.closeCurrentModal(),alert("Usuario nÃ£o cadastrado")):(e.class="state-submitted-successfully",o.closeCurrentModal(),console.log(a))})}o.closeCurrentModal(),console.log("Invalid form")}}),angular.module("BuscaAtivaEscolarAlert").filter("orderObjectBy",function(){return function(e,a,t){var r=[];return angular.forEach(e,function(e){r.push(e)}),r.sort(function(e,t){return e[a]>t[a]?1:-1}),t&&r.reverse(),r}}).factory("Cities",function(e){return headers={},e("http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/:id",{id:"@id"},{find:{method:"GET",headers:headers},search:{url:"http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/search",method:"POST",headers:headers},checkIfAvailable:{url:"http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/check_availability",method:"POST",headers:headers}})}),angular.module("BuscaAtivaEscolarAlert").factory("StaticData",function(e,a){function t(){console.log("[platform.static_data] Downloading latest static data definitions..."),h=a.get(p).then(n)}function r(){t()}function n(a){console.log("[platform.static_data] Downloaded! Version=",a.data.version,"Timestamp=",a.data.timestamp,"Data=",a.data.data),f=a.data.data,e.$broadcast("StaticData.ready")}function o(){return p}function l(){return f.length?f.length:0}function i(){return l()>0}function s(){return f.AlertCause?f.AlertCause:[]}function c(){return f.UFs?f.UFs:[]}function u(){return f.APIEndpoints?f.APIEndpoints:[]}function d(){return f.Config?f.Config.uploads.allowed_mime_types:[]}var f={},p="http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/static/static_data?version=latest",h={};return{fetchLatestVersion:t,refresh:r,getAlertCauses:s,getAllowedMimeTypes:d,getUFs:c,getAPIEndpoints:u,isReady:i,getNumChains:l,getDataFile:o}}).run(function(e){e.refresh()});