angular.module("BuscaAtivaEscolarAlert",["ngResource","ui.bootstrap","ui.select","ui.utils.masks","pathgather.popeye"]),angular.module("BuscaAtivaEscolarAlert").service("config",function(){var e="https://api.buscaativaescolar.org.br/api/v1/";return{getAPIEndpoint:function(){return e}}}),angular.module("BuscaAtivaEscolarAlert").controller("formCtrl",function(e,t,a,n,r,o,l){t.static=r,e.class="state-not-submitted",t.endpoint=l.getAPIEndpoint(),t.modal=function(t,a){e.isValid=t,e.alert=a;o.openModal({templateUrl:"confirm-dialog.html",controller:"formCtrl",closed:{}})},t.fetchCities=function(e){var a={name:e,$hide_loading_feedback:!0};return t.alert.place_uf&&(a.uf=t.alert.place_uf),console.log("[create_alert] Looking for cities: ",a),n.search(a).$promise.then(function(e){return e.results})},t.renderSelectedCity=function(e){return e?e.uf+" / "+e.name:""},t.createAlert=function(){if(e.isValid){console.log("success");var n={email:e.alert.email,name:e.alert.name,place_reference:e.alert.place_reference,alert_cause_id:e.alert.alert_cause_id,mother_name:e.alert.mother_name,place_address:e.alert.place_address,place_neighborhood:e.alert.place_neighborhood,place_city_id:e.alert.place_city.ibge_city_id,place_city_name:e.alert.place_city.name,place_uf:e.alert.place_uf};if(console.log(e.alert.dob),"undefined"!=typeof e.alert.dob){var r=new Date(e.alert.dob);r=r.toLocaleDateString("eu-ES"),console.log(r),n.dob=r}var l={headers:{"Content-Type":"application/json"}};return a.post(t.endpoint+"integration/lp/alert_spawn",JSON.stringify(n),l).then(function(t){"invalid_user"==t.data.reason?(console.log(t.data.reason),console.log("invalid_user"==t.data.reason),o.closeCurrentModal(),alert("Usuario nÃ£o cadastrado")):(e.class="state-submitted-successfully",o.closeCurrentModal(),console.log(t))})}o.closeCurrentModal(),console.log("Invalid form")}}),angular.module("BuscaAtivaEscolarAlert").filter("orderObjectBy",function(){return function(e,t,a){var n=[];return angular.forEach(e,function(e){n.push(e)}),n.sort(function(e,a){return e[t]>a[t]?1:-1}),a&&n.reverse(),n}}).factory("Cities",function(e,t){return headers={},e(t.getAPIEndpoint()+"cities/:id",{id:"@id"},{find:{method:"GET",headers:headers},search:{url:t.getAPIEndpoint()+"cities/search",method:"POST",headers:headers},checkIfAvailable:{url:t.getAPIEndpoint()+"cities/check_availability",method:"POST",headers:headers}})}),angular.module("BuscaAtivaEscolarAlert").factory("StaticData",function(e,t,a){function n(){console.log("[platform.static_data] Downloading latest static data definitions..."),console.log(g),m=t.get(g).then(o)}function r(){n()}function o(t){console.log("[platform.static_data] Downloaded! Version=",t.data.version,"Timestamp=",t.data.timestamp,"Data=",t.data.data),p=t.data.data,e.$broadcast("StaticData.ready")}function l(){return g}function i(){return p.length?p.length:0}function s(){return i()>0}function c(){return p.AlertCause?p.AlertCause:[]}function u(){return p.UFs?p.UFs:[]}function d(){return p.APIEndpoints?p.APIEndpoints:[]}function f(){return p.Config?p.Config.uploads.allowed_mime_types:[]}var p={},g=a.getAPIEndpoint()+"static/static_data?version=latest",m={};return{fetchLatestVersion:n,refresh:r,getAlertCauses:c,getAllowedMimeTypes:f,getUFs:u,getAPIEndpoints:d,isReady:s,getNumChains:i,getDataFile:l}}).run(function(e){e.refresh()});