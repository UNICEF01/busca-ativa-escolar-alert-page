angular.module("BuscaAtivaEscolarAlert",["ngResource","ui.bootstrap","ui.select","ui.utils.masks","pathgather.popeye"]),angular.module("BuscaAtivaEscolarAlert").controller("formCtrl",function(e,a,t,r,l,i){e.isValid,e.alert,a.static=l,e.class="state-not-submitted",e.message="muda?",a.modal=function(a,t){e.isValid=a,e.alert=t;i.openModal({templateUrl:"confirm-dialog.html",controller:"formCtrl",closed:{}})},a.fetchCities=function(e){var t={name:e,$hide_loading_feedback:!0};return a.alert.place_uf&&(t.uf=a.alert.place_uf),console.log("[create_alert] Looking for cities: ",t),r.search(t).$promise.then(function(e){return e.results})},a.renderSelectedCity=function(e){return e?e.uf+" / "+e.name:""},a.createAlert=function(){if(a.submitted=!0,console.log(e.isValid),console.log("Startando"),e.isValid){var r=new Date(e.alert.dob);console.log("success");var l={email:e.alert.email,name:e.alert.name,dob:r,place_reference:e.alert.place_reference,alert_cause_id:e.alert.alert_cause_id,mother_name:e.alert.mother_name,place_address:e.alert.place_address,place_neighborhood:e.alert.place_neighborhood,place_city_id:e.alert.place_city.ibge_city_id,place_city_name:e.alert.place_city.name,place_uf:e.alert.place_uf},o={headers:{"Content-Type":"application/json"}};return t.post("http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/integration/lp/alert_spawn",JSON.stringify(l),o).then(function(t){"invalid_user"==t.data.reason?(console.log(t.data.reason),console.log("invalid_user"==t.data.reason),a.message="Sorry bro",i.closeCurrentModal(),alert("Usuario nÃ£o cadastrado")):(e.class="state-submitted-successfully",i.closeCurrentModal(),console.log(t))})}i.closeCurrentModal(),console.log("Fail")}}),angular.module("BuscaAtivaEscolarAlert").factory("Cities",function(e){return headers={},e("http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/:id",{id:"@id"},{find:{method:"GET",headers:headers},search:{url:"http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/search",method:"POST",headers:headers},checkIfAvailable:{url:"http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/cities/check_availability",method:"POST",headers:headers}})}),angular.module("BuscaAtivaEscolarAlert").factory("StaticData",function(e,a){function t(){console.log("[platform.static_data] Downloading latest static data definitions..."),m=a.get(f).then(l)}function r(){t()}function l(a){console.log("[platform.static_data] Downloaded! Version=",a.data.version,"Timestamp=",a.data.timestamp,"Data=",a.data.data),p=a.data.data,e.$broadcast("StaticData.ready")}function i(){return f}function o(){return p.length?p.length:0}function n(){return o()>0}function s(){return p.AlertCause?p.AlertCause:[]}function c(){return p.UFs?p.UFs:[]}function d(){return p.APIEndpoints?p.APIEndpoints:[]}function u(){return p.Config?p.Config.uploads.allowed_mime_types:[]}var p={},f="http://api.busca-ativa-escolar.dev.lqdi.net/api/v1/static/static_data?version=latest",m={};return{fetchLatestVersion:t,refresh:r,getAlertCauses:s,getAllowedMimeTypes:u,getUFs:c,getAPIEndpoints:d,isReady:n,getNumChains:o,getDataFile:i}}).run(function(e){e.refresh()});